<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Mi primer libro digital</title>
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
  <div class="upload-container">
    <form id="upload-form">
      <label for="image-upload">Subir nueva imagen:</label>
      <input type="file" id="image-upload" name="image" required />
      <button type="submit">Subir</button>
    </form>
    <div id="upload-status"></div>
  </div>



  <div class="container">
    <div id="book">
      <div class="cover">
        <h2>Mi libro </br>primer digital</h2>
      </div>
    </div>

    <div id="controls">
      <label for="page-number">Página:</label>
      <input type="text" size="3" id="page-number"> de <span id="number-pages"></span>
    </div>

    <div id="navigation">
      <button id="prev-page" disabled>❮</button>
      <div class="space-button"></div>
      <button id="next-page">❯</button>
    </div>

    <div id="progress-bar">
      <div id="progress"></div>
    </div>

    <div>
      <p>De esta forma ChatGPT me ayudó a hacer este sitio: <a
          href="https://chatgpt.com/share/673b3e02-f458-8010-a4a9-bb09752ac8b3" target="_blank">link</a></p>
    </div>
  </div>
  <script type="text/javascript">
    // Número total de páginas
    var numberOfPages = 9;
  
    // Cargar dinámicamente URLs de imágenes desde metadata.json
    $.getJSON('/imagenes/metadata.json', function (data) {
      const imageUrls = [''].concat(data.images.map(img => `/imagenes/${img}`));
  
      // Inicializar el libro
      $('#book').turn({
        acceleration: true,
        pages: imageUrls.length,
        elevation: 50,
        gradients: !$.isTouch,
        when: {
          turning: function (e, page) {
            var range = $(this).turn('range', page);
            for (page = range[0]; page <= range[1]; page++) addPage(page, $(this));
          },
        },
      });
  
      // Función para agregar páginas al libro
      function addPage(page, book) {
        if (!book.turn('hasPage', page)) {
          const element = $('<div />', {
            'class': 'page ' + (page % 2 === 0 ? 'odd' : 'even'),
            'id': 'page-' + page,
          });
  
          if (imageUrls[page - 1]) {
            element.html('<img src="' + imageUrls[page - 1] + '" alt="Page ' + page + '" />');
          } else {
            element.html('<div class="data">Contenido para la página ' + page + '</div>');
          }
  
          book.turn('addPage', element, page);
        }
      }
    });
  
    $(window).ready(function () {
      $('#number-pages').html(numberOfPages);
  
      $('#page-number').keydown(function (e) {
        if (e.keyCode == 13)
          $('#book').turn('page', $('#page-number').val());
      });
    });
  
    $(window).bind('keydown', function (e) {
      if (e.target && e.target.tagName.toLowerCase() !== 'input') {
        if (e.keyCode == 37) $('#book').turn('previous');
        else if (e.keyCode == 39) $('#book').turn('next');
      }
    });
  
    // Botones de navegación
    document.getElementById('prev-page').addEventListener('click', () => {
      $('#book').turn('previous');
    });
  
    document.getElementById('next-page').addEventListener('click', () => {
      $('#book').turn('next');
    });
  
    // Desactivar botones al inicio/final
    $('#book').on('turned', function (event, page) {
      document.getElementById('prev-page').disabled = page === 1;
      document.getElementById('next-page').disabled = page === numberOfPages;
    });
  
    // Formulario de subida de imágenes
    $('#upload-form').on('submit', function (e) {
      e.preventDefault();
  
      const formData = new FormData();
      const fileInput = document.getElementById('image-upload');
      formData.append('image', fileInput.files[0]);
  
      $.ajax({
        url: '/upload',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          $('#upload-status').text(response.message);
          location.reload(); // Recargar la página para ver las nuevas imágenes
        },
        error: function (error) {
          $('#upload-status').text('Error al subir la imagen');
        },
      });
    });
  </script>  

  <script src="./script.js"></script>
</body>

</html>